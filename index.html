<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High & Low ディーラー版</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f0f0f0;color:#000;display:flex;justify-content:center;padding:12px;min-height:100vh;}
.app{width:100%;max-width:900px;background:#ffffff;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;}
.controls{display:flex;gap:6px;justify-content:center;}
.btn{background:rgba(0,0,0,0.05);color:#000;padding:4px 10px;border-radius:10px;border:none;font-weight:600;font-size:14px;cursor:pointer;height:32px;}
.btn.secondary{background:#f59e0b;color:#fff;}
.board{display:flex;flex-direction:column;gap:8px;background:#9acd32;padding:10px;border-radius:12px;} /* 黄緑背景 */
.card-display{display:flex;justify-content:center;gap:12px;align-items:center;}
.card{width:32vw;max-width:150px;height:46vw;max-height:220px;background:#fff;border-radius:12px;display:flex;flex-direction:column;padding:6px;justify-content:space-between;box-shadow:0 6px 18px rgba(0,0,0,0.25);position:relative;text-align:center;}
.card .corner{font-size:20px;position:absolute;color:black;} /* 図柄大きめ */
.card .top-left{top:6px;left:6px;}
.card .bottom-right{bottom:6px;right:6px;transform:rotate(180deg);}
.card .center{font-size:48px;font-weight:bold;color:black;display:flex;align-items:center;justify-content:center;flex:1;}
.card.face-down{background:#2e7d32;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;}
.participant-areas{display:flex;flex-direction:column;gap:6px;}
.waiting-area{text-align:center;}
.area-row{display:flex;gap:6px;}
.area{flex:1;background:rgba(0,0,0,0.05);padding:6px;border-radius:8px;min-height:80px;display:flex;flex-direction:column;gap:4px;}
.area h3{margin:0;color:#000;text-align:center;font-size:14px;}
.participant{background:rgba(0,0,0,0.05);padding:4px 6px;border-radius:6px;display:flex;align-items:center;color:#000;cursor:grab;user-select:none;}
.participant.dragging{opacity:0.5;}
.result{padding:6px;border-radius:6px;text-align:center;font-weight:700;min-height:36px;color:#000;position:relative;}
.result .win-label{position:absolute;top:-18px;left:50%;transform:translateX(-50%);font-weight:bold;color:red;}
.result.highlight{background:#ffffff;}
.stats{padding:4px;font-size:13px;color:#000;display:flex;flex-direction:column;gap:2px;}
footer{display:flex;justify-content:space-between;gap:6px;align-items:center;padding-top:6px;font-size:13px;color:#000;}

/* モーダル */
.modal{position: fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal-content{background:#fff;padding:20px;border-radius:12px;max-width:400px;text-align:center;color:#000;}
.modal-content h2{margin-top:0;}
</style>
</head>
<body>
<div class="app">

<div class="controls">
    <button class="btn" id="toggleWins">勝利回数表示</button>
    <button class="btn" id="toggleStreak">連勝表示</button>
</div>

<div class="participant-areas">
    <div class="waiting-area">
        <div style="font-size:14px;margin-bottom:4px;">ドラッグで移動</div>
        <div class="area" id="waitingArea"><h3>待機</h3></div>
    </div>
    <div class="area-row">
        <div class="area" id="highArea"><h3>HIGH</h3></div>
        <div class="area" id="lowArea"><h3>LOW</h3></div>
    </div>
</div>

<div class="board">
  <div class="card-display">
    <div class="card" id="currentCard">
      <div class="corner top-left" id="curTopLeft">♦</div>
      <div class="center" id="curCenter">?</div>
      <div class="corner bottom-right" id="curBottomRight">♦</div>
    </div>
    <div class="card face-down" id="nextCard">裏</div>
    <button class="btn secondary" id="nextGameBtn">次ゲーム</button>
  </div>
  <div class="result" id="result">参加者を追加してベットしてください</div>
</div>

<div class="stats" id="stats"></div>

<div style="margin-top:6px;">
  <button class="btn" id="resetAllBtn">全てリセット</button>
</div>

</div>

<!-- 注意喚起モーダル -->
<div id="consentModal" class="modal">
  <div class="modal-content">
    <h2>⚠ 注意 ⚠</h2>
    <p>
      配信媒体の規約や所属事務所等の規約を遵守し、
      国または自治体の法令・条例に則って活用してください。
    </p>
    <button id="consentBtn">確認</button>
  </div>
</div>

<script>
(function(){
const highArea=document.getElementById('highArea');
const lowArea=document.getElementById('lowArea');
const waitingArea=document.getElementById('waitingArea');
const toggleWinsBtn=document.getElementById('toggleWins');
const toggleStreakBtn=document.getElementById('toggleStreak');
const currentCardEl=document.getElementById('currentCard');
const curCenter=document.getElementById('curCenter');
const curTopLeft=document.getElementById('curTopLeft');
const curBottomRight=document.getElementById('curBottomRight');
const nextCardEl=document.getElementById('nextCard');
const nextGameBtn=document.getElementById('nextGameBtn');
const resultEl=document.getElementById('result');
const statsEl=document.getElementById('stats');
const resetBtn=document.getElementById('resetAllBtn');
const consentModal=document.getElementById('consentModal');
const consentBtn=document.getElementById('consentBtn');

let participants=[];
let showWins=false,showStreak=false;
let deck=[],current=null,nextCard=null;
const suits=[{sym:'♠'},{sym:'♥'},{sym:'♦'},{sym:'♣'}];
const ranks=[{r:'A',v:14},{r:'2',v:2},{r:'3',v:3},{r:'4',v:4},{r:'5',v:5},{r:'6',v:6},{r:'7',v:7},{r:'8',v:8},{r:'9',v:9},{r:'10',v:10},{r:'J',v:11},{r:'Q',v:12},{r:'K',v:13}];

function buildDeck(){const d=[];for(const s of suits) for(const r of ranks)d.push({rank:r.r,suit:s.sym,value:r.v}); return d;}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
function draw(){return deck.pop()||null;}
function effectiveValue(card){return card?card.value:0;}

function createParticipantDiv(p){
  const div=document.createElement('div');
  div.className='participant';
  div.textContent=p.name;
  if(showWins) div.textContent+=` (${p.wins})`;
  if(showStreak) div.textContent+='\n'+`連勝:${p.currentStreak}`;
  div.draggable=true;
  div.addEventListener('dragstart',e=>{div.classList.add('dragging'); e.dataTransfer.setData('text/plain', p.name);});
  div.addEventListener('dragend',()=>{div.classList.remove('dragging');});
  p.dom=div;
  return div;
}

function moveParticipant(p,targetArea){
  [highArea,lowArea,waitingArea].forEach(area=>{if(area.contains(p.dom)) area.removeChild(p.dom);});
  targetArea.appendChild(p.dom);
  if(targetArea===highArea) p.bet='high';
  else if(targetArea===lowArea) p.bet='low';
  else p.bet=null;
}

function renderParticipants(){
  highArea.innerHTML='<h3>HIGH</h3>';
  lowArea.innerHTML='<h3>LOW</h3>';
  waitingArea.innerHTML='<h3>待機</h3>';
  participants.forEach(p=>{
    if(!p.dom) createParticipantDiv(p);
    if(p.bet==='high') highArea.appendChild(p.dom);
    else if(p.bet==='low') lowArea.appendChild(p.dom);
    else waitingArea.appendChild(p.dom);
  });
  updateStats();
}

function updateStats(){
  statsEl.innerHTML='';
  if(showWins){statsEl.innerHTML='勝利: '+participants.map(p=>`${p.name}:${p.wins}`).join(' | ')+'<br>';}
  if(showStreak){statsEl.innerHTML+='連勝: '+participants.map(p=>`${p.name}:${p.currentStreak}`).join(' | ');}
}

function setCurrentCard(card){current=card;if(!card){curCenter.textContent='?'; curTopLeft.textContent='♦'; curBottomRight.textContent='♦'; return;}curCenter.textContent=card.rank;curTopLeft.textContent=card.suit;curBottomRight.textContent=card.suit;}
function setNextCard(card){nextCard=card;if(!card){nextCardEl.textContent='裏'; return;} nextCardEl.textContent='裏';}

function newRound(){deck=buildDeck(); shuffle(deck); setCurrentCard(draw()); setNextCard(draw()); participants.forEach(p=>p.bet=null); renderParticipants(); resultEl.textContent='カードをめくる前にベットを設定してください';}

// ドラッグエリアの受け入れ設定
[highArea,lowArea,waitingArea].forEach(area=>{
  area.addEventListener('dragover',e=>e.preventDefault());
  area.addEventListener('drop',e=>{
    e.preventDefault();
    const name=e.dataTransfer.getData('text/plain');
    const p=participants.find(x=>x.name===name);
    if(p) moveParticipant(p,area);
  });
});

toggleWinsBtn.onclick=()=>{showWins=!showWins; renderParticipants();}
toggleStreakBtn.onclick=()=>{showStreak=!showStreak; renderParticipants();}

nextCardEl.onclick=()=>{
  if(!nextCard) nextCard=draw();
  if(!current || !nextCard) return;
  const curVal=effectiveValue(current), nextVal=effectiveValue(nextCard);
  participants.forEach(p=>{
    if(!p.bet) return;
    const guess=p.bet;
    const win=(nextVal>curVal && guess==='high')||(nextVal<curVal && guess==='low');
    const lose=(nextVal>curVal && guess==='low')||(nextVal<curVal && guess==='high');
    if(win){p.wins++; p.currentStreak++; if(p.currentStreak>p.maxStreak)p.maxStreak=p.currentStreak;}
    if(lose){p.currentStreak=0;}
  });
  setCurrentCard(nextCard);
  setNextCard(draw());
  renderParticipants();
  resultEl.textContent='結果表示中';
  const winLabel=document.createElement('div'); winLabel.className='win-label'; winLabel.textContent='\\当たり/';
  resultEl.appendChild(winLabel);
  if(participants.some(p=>p.bet==='high' && effectiveValue(current)>effectiveValue(nextCard))) highArea.classList.add('highlight');
  else if(participants.some(p=>p.bet==='low' && effectiveValue(current)<effectiveValue(nextCard))) lowArea.classList.add('highlight');
  else {highArea.classList.add('highlight'); lowArea.classList.add('highlight');}
};

nextGameBtn.onclick=()=>{
  [highArea,lowArea,waitingArea].forEach(area=>area.classList.remove('highlight'));
  participants.forEach(p=>p.bet=null);
  renderParticipants();
  resultEl.textContent='次ゲーム開始';
};

resetBtn.onclick=()=>{participants=[]; deck=[]; current=null; nextCard=null; renderParticipants(); setCurrentCard(null); setNextCard(null); statsEl.innerHTML=''; resultEl.textContent='リセットされました';};

consentBtn.onclick=()=>{consentModal.style.display='none'; newRound();};

// サンプル参加者追加（任意）
participants.push({name:'たろう',bet:null,wins:0,currentStreak:0});
participants.push({name:'はなこ',bet:null,wins:0,currentStreak:0});
participants.push({name:'ひろし',bet:null,wins:0,currentStreak:0});
renderParticipants();

})();
</script>
</body>
</html>
