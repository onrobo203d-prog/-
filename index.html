<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High & Low ディーラー版</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f0f0f0;color:#000;display:flex;justify-content:center;padding:12px;min-height:100vh;}
.app{width:100%;max-width:900px;background:#fff;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;}
.controls{display:flex;gap:6px;justify-content:center;align-items:center;}
.controls input{flex:1;padding:4px 6px;border-radius:6px;border:1px solid #ccc;font-size:14px;}
.btn{background:rgba(0,0,0,0.05);color:#000;padding:4px 10px;border-radius:10px;border:none;font-weight:600;font-size:14px;cursor:pointer;height:32px;}
.btn.secondary{background:#f59e0b;color:#fff;}
.board{display:flex;flex-direction:column;gap:8px;background:#adff2f;padding:10px;border-radius:12px;}
.card-display{display:flex;justify-content:center;gap:12px;align-items:center;position:relative;}
.card{width:32vw;max-width:150px;height:46vw;max-height:220px;background:#fff;border-radius:12px;display:flex;flex-direction:column;padding:6px;justify-content:space-between;box-shadow:0 6px 18px rgba(0,0,0,0.25);position:relative;text-align:center;transition:transform 0.5s ease;}
.card .corner{font-size:24px;position:absolute;color:black;}
.card .top-left{top:6px;left:6px;}
.card .bottom-right{bottom:6px;right:6px;transform:rotate(180deg);}
.card .center{font-size:48px;font-weight:bold;color:black;display:flex;align-items:center;justify-content:center;flex:1;}
.card.face-down{background:#2e7d32;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;user-select:none;}
.participant-list{max-height:250px;overflow-y:auto;border:1px solid #ccc;border-radius:8px;padding:6px;display:flex;flex-direction:column;gap:4px;}
.participant{display:flex;align-items:center;justify-content:space-between;padding:4px 6px;border-radius:6px;background:rgba(0,0,0,0.05);cursor:pointer;user-select:none;}
.participant-name{flex:1;}
.bet-circle{width:20px;height:20px;border-radius:50%;margin-left:6px;background:transparent;transition:background 0.3s;}
.bet-H{background:#f87171;}
.bet-L{background:#60a5fa;}
.result{padding:6px;border-radius:6px;text-align:center;font-weight:700;min-height:36px;color:#000;position:relative;}
.stats{padding:4px;font-size:13px;color:#000;display:flex;flex-direction:column;gap:2px;}
.card.animate-flip { transform: rotateY(180deg); transition: transform 0.6s; }
.card.animate-move { transition: transform 0.5s ease-in-out; position: relative; }
/* モーダル */
.modal{position: fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal-content{background:#fff;padding:20px;border-radius:12px;max-width:400px;text-align:center;color:#000;}
.modal-content h2{margin-top:0;}
</style>
</head>
<body>
<div class="app">

<div class="controls">
    <button class="btn" id="toggleWins">勝利回数表示</button>
    <button class="btn" id="toggleStreak">連勝表示</button>
</div>

<div class="controls">
    <input type="text" id="participantInput" placeholder="参加者を記入">
    <button class="btn secondary" id="addParticipantBtn">追加</button>
</div>

<div class="participant-list" id="participantList"></div>

<div class="board">
  <div class="card-display">
    <div class="card" id="currentCard">
      <div class="corner top-left" id="curTopLeft">♦</div>
      <div class="center" id="curCenter">?</div>
      <div class="corner bottom-right" id="curBottomRight">♦</div>
    </div>
    <div class="card face-down" id="nextCard">裏</div>
    <button class="btn secondary" id="nextGameBtn">次ゲーム</button>
  </div>
  <div class="result" id="result">参加者を追加してベットしてください</div>
</div>

<div class="stats" id="stats"></div>

<div style="margin-top:6px;">
  <button class="btn" id="resetAllBtn">全てリセット</button>
</div>

</div>

<div id="consentModal" class="modal">
  <div class="modal-content">
    <h2>⚠ 注意 ⚠</h2>
    <p>
      配信媒体の規約や所属事務所等の規約を遵守し、
      国または自治体の法令・条例に則って活用してください。
    </p>
    <button id="consentBtn">確認</button>
  </div>
</div>

<script>
(function(){
const participantList = document.getElementById('participantList');
const toggleWinsBtn = document.getElementById('toggleWins');
const toggleStreakBtn = document.getElementById('toggleStreak');
const participantInput = document.getElementById('participantInput');
const addParticipantBtn = document.getElementById('addParticipantBtn');
const currentCardEl = document.getElementById('currentCard');
const curCenter = document.getElementById('curCenter');
const curTopLeft = document.getElementById('curTopLeft');
const curBottomRight = document.getElementById('curBottomRight');
const nextCardEl = document.getElementById('nextCard');
const nextGameBtn = document.getElementById('nextGameBtn');
const resultEl = document.getElementById('result');
const statsEl = document.getElementById('stats');
const resetBtn = document.getElementById('resetAllBtn');
const consentModal = document.getElementById('consentModal');
const consentBtn = document.getElementById('consentBtn');

let participants=[];
let showWins=false, showStreak=false;
let deck=[], current=null, nextCard=null;
const suits=[{sym:'♠'},{sym:'♥'},{sym:'♦'},{sym:'♣'}];
const ranks=[{r:'A',v:14},{r:'2',v:2},{r:'3',v:3},{r:'4',v:4},{r:'5',v:5},{r:'6',v:6},{r:'7',v:7},{r:'8',v:8},{r:'9',v:9},{r:'10',v:10},{r:'J',v:11},{r:'Q',v:12},{r:'K',v:13}];

function buildDeck(){const d=[];for(const s of suits) for(const r of ranks)d.push({rank:r.r,suit:s.sym,value:r.v}); return d;}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
function draw(){return deck.pop()||null;}
function effectiveValue(card){return card?card.value:0;}

// 参加者作成
function createParticipant(name){
  const p = {name, bet:null, wins:0, currentStreak:0};
  const div = document.createElement('div');
  div.className='participant';
  const nameSpan = document.createElement('span');
  nameSpan.className='participant-name';
  nameSpan.textContent = name;
  const circle = document.createElement('div');
  circle.className='bet-circle';
  div.appendChild(nameSpan);
  div.appendChild(circle);
  p.dom = div;
  p.nameSpan = nameSpan;
  p.circle = circle;

  // タップでHIGH⇄LOW切替
  div.addEventListener('click',()=>{
    if(p.bet==='high'){p.bet='low'; nameSpan.textContent='(L) '+p.name; nameSpan.style.color='#60a5fa';}
    else{p.bet='high'; nameSpan.textContent='(H) '+p.name; nameSpan.style.color='#f87171';}
    renderStats();
  });

  participants.push(p);
  participantList.appendChild(div);
  renderStats();
  return p;
}

// オプション
toggleWinsBtn.onclick=()=>{showWins=!showWins; renderStats();}
toggleStreakBtn.onclick=()=>{showStreak=!showStreak; renderStats();}

// 参加者追加
addParticipantBtn.onclick=()=>{
  const name = participantInput.value.trim();
  if(!name) return;
  createParticipant(name);
  participantInput.value='';
};
participantInput.addEventListener('keydown',e=>{if(e.key==='Enter') addParticipantBtn.click();});

// カード
function setCurrentCard(card){current=card;if(!card){curCenter.textContent='?'; curTopLeft.textContent='♦'; curBottomRight.textContent='♦'; return;}curCenter.textContent=card.rank;curTopLeft.textContent=card.suit; curBottomRight.textContent=card.suit;}
function setNextCard(card){nextCard=card;if(!card){nextCardEl.textContent='裏'; return;} nextCardEl.textContent='裏';}

// ラウンド開始
function newRound(){
  deck=buildDeck(); shuffle(deck);
  setCurrentCard(draw());
  setNextCard(draw());
  participants.forEach(p=>{p.bet=null; p.circle.style.background='transparent'; p.nameSpan.style.color='#000'; p.nameSpan.textContent=p.name;});
  resultEl.textContent='カードをめくる前にベットしてください';
}

// 次カードめくり
nextCardEl.onclick=()=>{
  if(!nextCard) nextCard=draw();
  if(!current || !nextCard) return;
  nextCardEl.classList.add('animate-flip');
  setTimeout(()=>{
    nextCardEl.classList.remove('animate-flip');
    nextCardEl.innerHTML=`<div class="corner top-left">${nextCard.suit}</div><div class="center">${nextCard.rank}</div><div class="corner bottom-right">${nextCard.suit}</div>`;
    
    const curVal = effectiveValue(current), nextVal = effectiveValue(nextCard);
    participants.forEach(p=>{
      if(!p.bet) return;
      const win = (nextVal>curVal && p.bet==='high')||(nextVal<curVal && p.bet==='low');
      if(win){p.wins++; p.currentStreak++; p.circle.style.background='#fdd835';} 
      else {p.currentStreak=0; p.circle.style.background='transparent';}
    });
    renderStats();
    resultEl.textContent='結果表示中';
  },100);
};

// 次ゲーム
nextGameBtn.onclick=()=>{
  participants.forEach(p=>{p.circle.style.background='transparent';});
  setCurrentCard(nextCard);
  nextCardEl.textContent='裏'; nextCardEl.innerHTML='';
  nextCard=draw();
  participants.forEach(p=>{p.bet=null; p.nameSpan.style.color='#000'; p.nameSpan.textContent=p.name;});
  resultEl.textContent='次ゲーム開始';
  renderStats();
};

// リセット
resetBtn.onclick=()=>{
  participants.forEach(p=>{
    p.bet=null; p.wins=0; p.currentStreak=0; p.circle.style.background='transparent';
    p.nameSpan.style.color='#000'; p.nameSpan.textContent=p.name;
  });
  deck=buildDeck(); shuffle(deck);
  setCurrentCard(draw());
  setNextCard(draw());
  resultEl.textContent='リセットされました';
  renderStats();
};

// スタッツ表示
function renderStats(){
  statsEl.innerHTML='';
  if(showWins){statsEl.innerHTML='勝利: '+participants.map(p=>`${p.name}:${p.wins}`).join(' | ')+'<br>';}
  if(showStreak){statsEl.innerHTML+='連勝: '+participants.map(p=>`${p.name}:${p.currentStreak}`).join(' | ');}
}

consentBtn.onclick=()=>{consentModal.style.display='none'; newRound();};
})();
</script>
</body>
</html>
