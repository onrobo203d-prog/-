<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High & Low ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ç‰ˆ</title>
<style>
:root{
  --bg:#0f1724; --card-bg:#ffffff; --card-back:#1f2937;
  --accent:#06b6d4; --text:#e6eef6; --danger:#ef4444; --success:#10b981;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial, sans-serif;background:linear-gradient(180deg,#071126 0%,#0b1220 100%);color:var(--text);display:flex;justify-content:center;padding:16px;min-height:100vh;}
.app{width:100%;max-width:900px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:12px;position:relative;}
header{display:flex;justify-content:space-between;align-items:center;gap:12px;}
header h1{font-size:16px;margin:0;}
.controls{display:flex;gap:8px;}
.btn{background:rgba(255,255,255,0.06);color:var(--text);padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);font-weight:600;font-size:14px;min-height:40px;display:inline-flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;}
.btn:active{transform:translateY(1px);}
.btn.primary{background:linear-gradient(180deg,var(--accent),#0ea5b7);color:#052024;border:none;box-shadow:0 6px 18px rgba(6,182,212,0.18);}
.board{display:flex;gap:10px;align-items:center;justify-content:space-around;flex-wrap:wrap;}
.stack,.card-slot{width:32vw;max-width:150px;min-width:120px;height:46vw;max-height:220px;min-height:170px;display:flex;align-items:center;justify-content:center;position:relative;}
.card{width:100%;height:100%;border-radius:12px;background:var(--card-bg);display:flex;flex-direction:column;padding:10px;box-shadow:0 8px 30px rgba(2,6,23,0.55);border:1px solid rgba(2,6,23,0.08);transition:transform .25s ease, opacity .25s ease;user-select:none;position:relative;}
.card.face-down{background:linear-gradient(135deg,var(--card-back),#111827);color:white;display:flex;align-items:center;justify-content:center;font-size:20px;}
.card .top,.card .bottom{display:flex;align-items:flex-start;justify-content:flex-start;gap:6px;font-weight:700;font-size:18px;}
.card .bottom{align-items:flex-end;justify-content:flex-end;transform:rotate(180deg);}
.card .center{flex:1;display:flex;align-items:center;justify-content:center;font-size:48px;line-height:1;}
.suit.red{color:#dc2626}
.suit.black{color:#111827}
.result{padding:10px;border-radius:10px;text-align:center;font-weight:700;min-height:46px;display:flex;align-items:center;justify-content:center;gap:8px;}
.result.win{background: rgba(16,185,129,0.12); color:var(--success); border:1px solid rgba(16,185,129,0.12)}
.result.lose{background: rgba(239,68,68,0.08); color:var(--danger); border:1px solid rgba(239,68,68,0.06)}
.result.tie{background: rgba(255,255,255,0.02); color: #f59e0b; border:1px solid rgba(255,255,255,0.02)}

.participant{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.08);}
.participant-name{flex:1;text-align:center;}
.arrow-btn{padding:2px 6px;border-radius:6px;border:none;background:rgba(255,255,255,0.1);color:#fff;margin:0 4px;cursor:pointer;}

footer{display:flex;justify-content:space-between;gap:8px;align-items:center;padding-top:6px;font-size:13px;color:rgba(230,238,246,0.85);}

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal{position: fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal-content{background:#fff;padding:20px;border-radius:12px;max-width:400px;text-align:center;color:#000;}
.modal-content h2{margin-top:0;}
</style>
</head>
<body>
<div class="app" id="app">

<header>
  <h1>High & Low ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ç‰ˆ</h1>
  <div class="controls">
    <button class="btn" id="addParticipantBtn">ï¼‹å‚åŠ è€…è¿½åŠ </button>
    <button class="btn" id="toggleWins">å‹åˆ©å›æ•°è¡¨ç¤º</button>
    <button class="btn" id="toggleStreak">é€£å‹è¡¨ç¤º</button>
  </div>
</header>

<main id="participantArea">
  <div id="participantsList"></div>
</main>

<div class="board" id="gameBoard" style="display:none;">
  <div class="stack deck" id="deckSlot">
    <div class="pile" id="deckPile">ğŸ‚ </div>
    <div class="count" id="deckCount">52 æš</div>
  </div>

  <div class="card-slot" id="currentSlot">
    <div class="card" id="currentCard">
      <div class="top"><span id="curRankTop">â€”</span> <span id="curSuitTop" class="suit"> </span></div>
      <div class="center" id="curCenter">?</div>
      <div class="bottom"><span id="curRankBottom">â€”</span> <span id="curSuitBottom" class="suit"> </span></div>
    </div>
  </div>

  <div class="card-slot" id="nextSlot">
    <div class="card face-down" id="nextCard">è£</div>
  </div>
</div>

<div style="display:flex;gap:8px;margin-top:6px;">
  <button class="btn primary" id="drawNext" style="flex:1">ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹</button>
  <button class="btn ghost" id="clearBets" style="flex:1">å…¨å“¡ãƒ™ãƒƒãƒˆã‚¯ãƒªã‚¢</button>
</div>

<div id="result" class="result" aria-live="polite">å‚åŠ è€…ã‚’è¿½åŠ ã—ã¦ãƒ™ãƒƒãƒˆã—ã¦ãã ã•ã„</div>

<footer>
  <div id="stats"></div>
</footer>
</div>

<!-- æ³¨æ„å–šèµ·ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="consentModal" class="modal">
  <div class="modal-content">
    <h2>âš  æ³¨æ„ âš </h2>
    <p>
      é…ä¿¡åª’ä½“ã®è¦ç´„ã‚„æ‰€å±äº‹å‹™æ‰€ç­‰ã®è¦ç´„ã‚’éµå®ˆã—ã€
      å›½ã¾ãŸã¯è‡ªæ²»ä½“ã®æ³•ä»¤ãƒ»æ¡ä¾‹ã«å‰‡ã£ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚
    </p>
    <button id="consentBtn">ç¢ºèª</button>
  </div>
</div>

<script>
(function(){
  // --- DOM ---
  const participantArea = document.getElementById('participantArea');
  const participantsList = document.getElementById('participantsList');
  const toggleWinsBtn = document.getElementById('toggleWins');
  const toggleStreakBtn = document.getElementById('toggleStreak');
  const addParticipantBtn = document.getElementById('addParticipantBtn');
  const drawNextBtn = document.getElementById('drawNext');
  const clearBetsBtn = document.getElementById('clearBets');
  const gameBoard = document.getElementById('gameBoard');
  const deckCountEl = document.getElementById('deckCount');
  const deckPileEl = document.getElementById('deckPile');
  const currentCardEl = document.getElementById('currentCard');
  const curRankTop = document.getElementById('curRankTop');
  const curSuitTop = document.getElementById('curSuitTop');
  const curRankBottom = document.getElementById('curRankBottom');
  const curSuitBottom = document.getElementById('curSuitBottom');
  const curCenter = document.getElementById('curCenter');
  const nextCardEl = document.getElementById('nextCard');
  const resultEl = document.getElementById('result');
  const statsEl = document.getElementById('stats');
  const consentModal = document.getElementById('consentModal');
  const consentBtn = document.getElementById('consentBtn');

  // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ---
  let participants = [];
  let showWins=false, showStreak=false;
  let deck=[], current=null, nextCard=null;
  let suits=[{sym:'â™ ',cls:'black'},{sym:'â™¥',cls:'red'},{sym:'â™¦',cls:'red'},{sym:'â™£',cls:'black'}];
  let ranks=[{r:'A',v:14},{r:'2',v:2},{r:'3',v:3},{r:'4',v:4},{r:'5',v:5},{r:'6',v:6},{r:'7',v:7},{r:'8',v:8},{r:'9',v:9},{r:'10',v:10},{r:'J',v:11},{r:'Q',v:12},{r:'K',v:13}];

  // --- åˆæœŸåŒ– ---
  function buildDeck(){
    const d=[];
    for(const s of suits) for(const r of ranks)d.push({rank:r.r,suit:s.sym,suitClass:s.cls,value:r.v});
    return d;
  }
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
  function drawFromDeck(){return deck.pop()||null;}
  function effectiveValue(card){if(!card)return 0;return card.rank==='A'?14:card.value;}

  function renderParticipants(){
    participantsList.innerHTML='';
    participants.forEach((p,i)=>{
      const div=document.createElement('div');
      div.className='participant';
      const lowBtn=document.createElement('button'); lowBtn.className='arrow-btn'; lowBtn.textContent='â†';
      const highBtn=document.createElement('button'); highBtn.className='arrow-btn'; highBtn.textContent='â†’';
      const nameDiv=document.createElement('div'); nameDiv.className='participant-name';
      let txt=p.name;
      if(showWins) txt+=` (${p.wins})`;
      if(showStreak) txt+='\n'+`é€£å‹: ${p.currentStreak}`;
      nameDiv.textContent=txt;
      lowBtn.onclick=()=>{p.bet='low'; renderParticipants();}
      highBtn.onclick=()=>{p.bet='high'; renderParticipants();}
      div.appendChild(lowBtn); div.appendChild(nameDiv); div.appendChild(highBtn);
      participantsList.appendChild(div);
    });
    updateStats();
  }

  function updateStats(){
    statsEl.innerHTML='';
    if(showWins){
      let html='å‹åˆ©å›æ•°: ';
      html+=participants.map(p=>`${p.name}: ${p.wins}`).join(' | ');
      statsEl.innerHTML=html;
    }
    if(showStreak){
      let html='é€£å‹: ';
      html+=participants.map(p=>`${p.name}: ${p.currentStreak}`).join(' | ');
      statsEl.innerHTML+=html?'<br>'+html:'';
    }
  }

  function setCurrent(card){
    current=card;
    if(!card){curRankTop.textContent='â€”';curSuitTop.textContent='';curRankBottom.textContent='â€”';curSuitBottom.textContent='';curCenter.textContent='?';return;}
    curRankTop.textContent=card.rank; curSuitTop.textContent=card.suit; curSuitTop.className='suit '+card.suitClass;
    curRankBottom.textContent=card.rank; curSuitBottom.textContent=card.suit; curSuitBottom.className='suit '+card.suitClass;
    curCenter.textContent=card.suit; curCenter.className='suit '+card.suitClass;
  }
  function setNext(card,faceUp=false){
    nextCard=card;
    if(!card){nextCardEl.textContent='è£'; nextCardEl.classList.add('face-down'); return;}
    if(faceUp){
      nextCardEl.classList.remove('face-down');
      nextCardEl.textContent=card.rank+card.suit;
    }else{
      nextCardEl.textContent='è£'; nextCardEl.classList.add('face-down');
    }
  }

  function newRound(){
    deck=buildDeck(); shuffle(deck);
    setCurrent(drawFromDeck());
    setNext(drawFromDeck(),false);
    deckCountEl.textContent=deck.length+' æš';
    participants.forEach(p=>p.bet=null);
    renderParticipants();
    resultEl.textContent='ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹å‰ã«ãƒ™ãƒƒãƒˆã‚’è¨­å®šã—ã¦ãã ã•ã„';
    gameBoard.style.display='flex';
  }

  drawNextBtn.addEventListener('click',()=>{
    if(!nextCard){setNext(drawFromDeck(),false);}
    if(!current || !nextCard){return;}
    setNext(nextCard,true);
    const curVal=effectiveValue(current);
    const nextVal=effectiveValue(nextCard);
    participants.forEach(p=>{
      if(!p.bet) return;
      const guess=p.bet;
      const win=(nextVal>curVal && guess==='high')||(nextVal<curVal && guess==='low');
      const lose=(nextVal>curVal && guess==='low')||(nextVal<curVal && guess==='high');
      if(win){p.wins++; p.currentStreak++; if(p.currentStreak>p.maxStreak)p.maxStreak=p.currentStreak;}
      if(lose){p.currentStreak=0;}
      if(nextVal===curVal){ /* å¼•ãåˆ†ã‘: current streak ç¶­æŒ */ }
    });
    setCurrent(nextCard);
    setNext(drawFromDeck(),false);
    deckCountEl.textContent=deck.length+' æš';
    renderParticipants();
  });

  clearBetsBtn.addEventListener('click',()=>{participants.forEach(p=>p.bet=null); renderParticipants();});

  addParticipantBtn.addEventListener('click',()=>{
    const name=prompt('å‚åŠ è€…åã‚’å…¥åŠ›');
    if(!name) return;
    participants.push({name:name,bet:null,wins:0,currentStreak:0,maxStreak:0});
    renderParticipants();
  });

  toggleWinsBtn.addEventListener('click',()=>{showWins=!showWins; renderParticipants();});
  toggleStreakBtn.addEventListener('click',()=>{showStreak=!showStreak; renderParticipants();});

  // æ³¨æ„å–šèµ·ãƒ¢ãƒ¼ãƒ€ãƒ«
  consentBtn.addEventListener('click',()=>{
    consentModal.style.display='none';
    newRound();
  });

})();
</script>
</body>
</html>
