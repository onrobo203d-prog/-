<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High & Low ディーラー版</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f0f0f0;color:#000;display:flex;justify-content:center;padding:12px;min-height:100vh;}
.app{width:100%;max-width:900px;background:#fff;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;}
.controls{display:flex;gap:6px;justify-content:center;align-items:center;}
.controls input{flex:1;padding:4px 6px;border-radius:6px;border:1px solid #ccc;font-size:14px;}
.btn{background:rgba(0,0,0,0.05);color:#000;padding:4px 10px;border-radius:10px;border:none;font-weight:600;font-size:14px;cursor:pointer;height:32px;}
.btn.secondary{background:#f59e0b;color:#fff;}
.board{display:flex;flex-direction:column;gap:8px;background:#9acd32;padding:10px;border-radius:12px;}
.card-display{display:flex;justify-content:center;gap:12px;align-items:center;position:relative;}
.card{width:32vw;max-width:150px;height:46vw;max-height:220px;background:#fff;border-radius:12px;display:flex;flex-direction:column;padding:6px;justify-content:space-between;box-shadow:0 6px 18px rgba(0,0,0,0.25);position:relative;text-align:center;transition:transform 0.5s ease;}
.card .corner{font-size:20px;position:absolute;color:black;}
.card .top-left{top:6px;left:6px;}
.card .bottom-right{bottom:6px;right:6px;transform:rotate(180deg);}
.card .center{font-size:48px;font-weight:bold;color:black;display:flex;align-items:center;justify-content:center;flex:1;}
.card.face-down{background:#2e7d32;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;user-select:none;}
.participant-areas{display:flex;flex-direction:column;gap:6px;}
.waiting-area{text-align:center;}
.area-row{display:flex;gap:6px;}
.area{flex:1;background:rgba(0,0,0,0.05);padding:6px;border-radius:8px;min-height:80px;display:flex;flex-direction:column;gap:4px;transition:background 0.3s;}
.area h3{margin:0;color:#000;text-align:center;font-size:14px;}
.participant{background:rgba(0,0,0,0.05);padding:4px 6px;border-radius:6px;display:flex;align-items:center;color:#000;cursor:pointer;user-select:none;position:relative;}
.result{padding:6px;border-radius:6px;text-align:center;font-weight:700;min-height:36px;color:#000;position:relative;}
.stats{padding:4px;font-size:13px;color:#000;display:flex;flex-direction:column;gap:2px;}
.area.highlight-high { background-color: #ffff99; }
.area.highlight-low  { background-color: #99ccff; }
.card.animate-flip { transform: rotateY(180deg); transition: transform 0.6s; }
.card.animate-move { transition: transform 0.5s ease-in-out; position: relative; }
/* モーダル */
.modal{position: fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal-content{background:#fff;padding:20px;border-radius:12px;max-width:400px;text-align:center;color:#000;}
.modal-content h2{margin-top:0;}
</style>
</head>
<body>
<div class="app">

<div class="controls">
    <button class="btn" id="toggleWins">勝利回数表示</button>
    <button class="btn" id="toggleStreak">連勝表示</button>
</div>

<div class="controls">
    <input type="text" id="participantInput" placeholder="参加者を記入">
    <button class="btn secondary" id="addParticipantBtn">追加</button>
</div>

<div class="participant-areas">
    <div class="waiting-area">
        <div style="font-size:14px;margin-bottom:4px;">ドラッグで移動</div>
        <div class="area" id="waitingArea"><h3>待機</h3></div>
    </div>
    <div class="area-row">
        <div class="area" id="highArea"><h3>HIGH</h3></div>
        <div class="area" id="lowArea"><h3>LOW</h3></div>
    </div>
</div>

<div class="board">
  <div class="card-display">
    <div class="card" id="currentCard">
      <div class="corner top-left" id="curTopLeft">♦</div>
      <div class="center" id="curCenter">?</div>
      <div class="corner bottom-right" id="curBottomRight">♦</div>
    </div>
    <div class="card face-down" id="nextCard">裏</div>
    <button class="btn secondary" id="nextGameBtn">次ゲーム</button>
  </div>
  <div class="result" id="result">参加者を追加してベットしてください</div>
</div>

<div class="stats" id="stats"></div>

<div style="margin-top:6px;">
  <button class="btn" id="resetAllBtn">全てリセット</button>
</div>

</div>

<div id="consentModal" class="modal">
  <div class="modal-content">
    <h2>⚠ 注意 ⚠</h2>
    <p>
      配信媒体の規約や所属事務所等の規約を遵守し、
      国または自治体の法令・条例に則って活用してください。
    </p>
    <button id="consentBtn">確認</button>
  </div>
</div>

<script>
(function(){
const highArea=document.getElementById('highArea');
const lowArea=document.getElementById('lowArea');
const waitingArea=document.getElementById('waitingArea');
const toggleWinsBtn=document.getElementById('toggleWins');
const toggleStreakBtn=document.getElementById('toggleStreak');
const participantInput=document.getElementById('participantInput');
const addParticipantBtn=document.getElementById('addParticipantBtn');
const currentCardEl=document.getElementById('currentCard');
const curCenter=document.getElementById('curCenter');
const curTopLeft=document.getElementById('curTopLeft');
const curBottomRight=document.getElementById('curBottomRight');
const nextCardEl=document.getElementById('nextCard');
const nextGameBtn=document.getElementById('nextGameBtn');
const resultEl=document.getElementById('result');
const statsEl=document.getElementById('stats');
const resetBtn=document.getElementById('resetAllBtn');
const consentModal=document.getElementById('consentModal');
const consentBtn=document.getElementById('consentBtn');

let participants=[];
let showWins=false,showStreak=false;
let deck=[],current=null,nextCard=null;
const suits=[{sym:'♠'},{sym:'♥'},{sym:'♦'},{sym:'♣'}];
const ranks=[{r:'A',v:14},{r:'2',v:2},{r:'3',v:3},{r:'4',v:4},{r:'5',v:5},{r:'6',v:6},{r:'7',v:7},{r:'8',v:8},{r:'9',v:9},{r:'10',v:10},{r:'J',v:11},{r:'Q',v:12},{r:'K',v:13}];

function buildDeck(){const d=[];for(const s of suits) for(const r of ranks)d.push({rank:r.r,suit:s.sym,value:r.v}); return d;}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
function draw(){return deck.pop()||null;}
function effectiveValue(card){return card?card.value:0;}

function createParticipantDiv(p){
  const div=document.createElement('div');
  div.className='participant';
  function renderName(){
    div.textContent=p.name;
    if(showWins) div.textContent+=' ('+p.wins+')';
    if(showStreak) div.textContent+=' 連勝:'+p.currentStreak;
  }
  renderName();
  p.renderName = renderName;
  p.dom=div;
  return div;
}

function moveParticipant(p,targetArea){
  [highArea,lowArea,waitingArea].forEach(area=>{if(area.contains(p.dom)) area.removeChild(p.dom);});
  targetArea.appendChild(p.dom);
  if(targetArea===highArea) p.bet='high';
  else if(targetArea===lowArea) p.bet='low';
  else p.bet=null;
}

function renderParticipants(){
  highArea.innerHTML='<h3>HIGH</h3>';
  lowArea.innerHTML='<h3>LOW</h3>';
  waitingArea.innerHTML='<h3>待機</h3>';
  participants.forEach(p=>{
    if(!p.dom) createParticipantDiv(p);
    if(p.bet==='high') highArea.appendChild(p.dom);
    else if(p.bet==='low') lowArea.appendChild(p.dom);
    else waitingArea.appendChild(p.dom);
    p.renderName();
  });
  updateStats();
}

function updateStats(){
  statsEl.innerHTML='';
  if(showWins){statsEl.innerHTML='勝利: '+participants.map(p=>`${p.name}:${p.wins}`).join(' | ')+'<br>';}
  if(showStreak){statsEl.innerHTML+='連勝: '+participants.map(p=>`${p.name}:${p.currentStreak}`).join(' | ');}
}

function setCurrentCard(card){current=card;if(!card){curCenter.textContent='?'; curTopLeft.textContent='♦'; curBottomRight.textContent='♦'; return;}curCenter.textContent=card.rank;curTopLeft.textContent=card.suit;curBottomRight.textContent=card.suit;}
function setNextCard(card){nextCard=card;if(!card){nextCardEl.textContent='裏'; return;} nextCardEl.textContent='裏';}

function newRound(){deck=buildDeck(); shuffle(deck); setCurrentCard(draw()); setNextCard(draw()); participants.forEach(p=>p.bet=null); renderParticipants(); resultEl.textContent='カードをめくる前にベットを設定してください';}

// ドラッグ即反応
let dragged=null,offsetX=0,offsetY=0;
document.addEventListener('mousemove',e=>{
  if(dragged){dragged.style.position='absolute'; dragged.style.zIndex=1000;
    dragged.style.left=(e.clientX-offsetX)+'px';
    dragged.style.top=(e.clientY-offsetY)+'px';
  }
});
document.addEventListener('mouseup',e=>{
  if(dragged){
    // ドロップ判定
    const areas=[highArea,lowArea,waitingArea];
    let dropped=false;
    areas.forEach(area=>{
      const rect=area.getBoundingClientRect();
      if(e.clientX>rect.left && e.clientX<rect.right && e.clientY>rect.top && e.clientY<rect.bottom){
        const p=participants.find(p=>p.dom===dragged);
        if(p) moveParticipant(p,area);
        dropped=true;
      }
    });
    if(!dropped){
      // 元の位置へ戻す
      renderParticipants();
    }
    dragged.style.position='relative';
    dragged.style.zIndex='auto';
    dragged=null;
  }
});

// ドラッグ開始
function enableDrag(p){
  p.dom.addEventListener('mousedown',e=>{
    dragged=p.dom;
    const rect=dragged.getBoundingClientRect();
    offsetX=e.clientX-rect.left;
    offsetY=e.clientY-rect.top;
  });
}

// オプション
toggleWinsBtn.onclick=()=>{showWins=!showWins; renderParticipants();}
toggleStreakBtn.onclick=()=>{showStreak=!showStreak; renderParticipants();}

// 参加者追加
addParticipantBtn.onclick=()=>{
  const name=participantInput.value.trim(); 
  if(!name) return; 
  const p={name,bet:null,wins:0,currentStreak:0,dom:null};
  participants.push(p);
  participantInput.value=''; 
  renderParticipants();
  enableDrag(p);
};
participantInput.addEventListener('keydown',e=>{if(e.key==='Enter') addParticipantBtn.click();});

// 次カードクリックでめくる
nextCardEl.onclick=()=>{
  if(!nextCard) nextCard=draw();
  if(!current || !nextCard) return;
  nextCardEl.classList.add('animate-flip');
  setTimeout(()=>{
    nextCardEl.classList.remove('animate-flip');
    nextCardEl.innerHTML=`<div class="corner top-left">${nextCard.suit}</div><div class="center">${nextCard.rank}</div><div class="corner bottom-right">${nextCard.suit}</div>`;
    
    const curVal=effectiveValue(current), nextVal=effectiveValue(nextCard);
    highArea.classList.remove('highlight-high'); 
    lowArea.classList.remove('highlight-low');

    participants.forEach(p=>{
      if(!p.bet) return;
      const guess=p.bet;
      const win=(nextVal>curVal && guess==='high')||(nextVal<curVal && guess==='low');
      const lose=(nextVal>curVal && guess==='low')||(nextVal>curVal && guess==='high');
      if(win){p.wins++; p.currentStreak++;}
      if(lose){p.currentStreak=0;}
      if(win && guess==='high') highArea.classList.add('highlight-high');
      if(win && guess==='low') lowArea.classList.add('highlight-low');
    });

    renderParticipants();
    resultEl.textContent='結果表示中';
  }, 100);
};

// 次ゲーム
nextGameBtn.onclick=()=>{
  highArea.classList.remove('highlight-high');
  lowArea.classList.remove('highlight-low');

  nextCardEl.classList.add('animate-move');
  setTimeout(()=>{
    setCurrentCard(nextCard);
    nextCardEl.textContent='裏';
    nextCardEl.innerHTML='';
    nextCardEl.classList.remove('animate-move');
    nextCard=draw();
  },500);

  participants.forEach(p=>p.bet=null);
  renderParticipants();
  resultEl.textContent='次ゲーム開始';
};

// リセット
resetBtn.onclick=()=>{participants=[]; deck=[]; current=null; nextCard=null; renderParticipants(); setCurrentCard(null); setNextCard(null); statsEl.innerHTML=''; resultEl.textContent='リセットされました';};

consentBtn.onclick=()=>{consentModal.style.display='none'; newRound();};

// 初期参加者サンプル
['たろう','はなこ','ひろし'].forEach(name=>{
  const p={name,bet:null,wins:0,currentStreak:0,dom:null};
  participants.push(p);
  enableDrag(p);
});
renderParticipants();

})();
</script>
</body>
</html>
