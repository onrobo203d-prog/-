<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High & Low ディーラー版</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f0f0f0;color:#000;display:flex;justify-content:center;padding:12px;min-height:100vh;}
.app{width:100%;max-width:900px;background:#fff;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;}
.controls{display:flex;gap:6px;justify-content:center;align-items:center;}
.controls input{flex:1;padding:4px 6px;border-radius:6px;border:1px solid #ccc;font-size:14px;}
.btn{background:rgba(0,0,0,0.05);color:#000;padding:4px 10px;border-radius:10px;border:none;font-weight:600;font-size:14px;cursor:pointer;height:32px;}
.btn.secondary{background:#f59e0b;color:#fff;}
.board{display:flex;flex-direction:column;gap:8px;background:#adff2f;padding:10px;border-radius:12px;}
.card-display{display:flex;justify-content:center;gap:12px;align-items:center;position:relative;}
.card{width:32vw;max-width:150px;height:46vw;max-height:220px;background:#fff;border-radius:12px;display:flex;flex-direction:column;padding:6px;justify-content:space-between;box-shadow:0 6px 18px rgba(0,0,0,0.25);position:relative;text-align:center;transition:transform 0.5s ease;}
.card .corner{font-size:24px;position:absolute;color:black;}
.card .top-left{top:6px;left:6px;}
.card .bottom-right{bottom:6px;right:6px;transform:rotate(180deg);}
.card .center{font-size:48px;font-weight:bold;color:black;display:flex;align-items:center;justify-content:center;flex:1;}
.card.face-down{background:#2e7d32;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;user-select:none;}
.participant-areas{display:flex;flex-direction:column;gap:6px;}
.waiting-area{text-align:center;}
.area-row{display:flex;gap:6px;}
.area{flex:1;background:rgba(0,0,0,0.05);padding:6px;border-radius:8px;min-height:80px;display:flex;flex-direction:column;gap:4px;transition:background 0.3s;position:relative;}
.area h3{margin:0;color:#000;text-align:center;font-size:14px;}
.participant{background:rgba(0,0,0,0.05);padding:4px 6px;border-radius:6px;display:flex;align-items:center;color:#000;cursor:pointer;user-select:none;position:absolute;}
.result{padding:6px;border-radius:6px;text-align:center;font-weight:700;min-height:36px;color:#000;position:relative;}
.stats{padding:4px;font-size:13px;color:#000;display:flex;flex-direction:column;gap:2px;}
.area.highlight-high { background-color: #ffff99; }
.area.highlight-low  { background-color: #99ccff; }
.card.animate-flip { transform: rotateY(180deg); transition: transform 0.6s; }
.card.animate-move { transition: transform 0.5s ease-in-out; position: relative; }
/* モーダル */
.modal{position: fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal-content{background:#fff;padding:20px;border-radius:12px;max-width:400px;text-align:center;color:#000;}
.modal-content h2{margin-top:0;}
</style>
</head>
<body>
<div class="app">

<div class="controls">
    <button class="btn" id="toggleWins">勝利回数表示</button>
    <button class="btn" id="toggleStreak">連勝表示</button>
</div>

<div class="controls">
    <input type="text" id="participantInput" placeholder="参加者を記入">
    <button class="btn secondary" id="addParticipantBtn">追加</button>
</div>

<div class="participant-areas">
    <div class="waiting-area">
        <div style="font-size:14px;margin-bottom:4px;">ドラッグで移動</div>
        <div class="area" id="waitingArea"><h3>待機</h3></div>
    </div>
    <div class="area-row">
        <div class="area" id="highArea"><h3>HIGH</h3></div>
        <div class="area" id="lowArea"><h3>LOW</h3></div>
    </div>
</div>

<div class="board">
  <div class="card-display">
    <div class="card" id="currentCard">
      <div class="corner top-left" id="curTopLeft">♦</div>
      <div class="center" id="curCenter">?</div>
      <div class="corner bottom-right" id="curBottomRight">♦</div>
    </div>
    <div class="card face-down" id="nextCard">裏</div>
    <button class="btn secondary" id="nextGameBtn">次ゲーム</button>
  </div>
  <div class="result" id="result">参加者を追加してベットしてください</div>
</div>

<div class="stats" id="stats"></div>

<div style="margin-top:6px;">
  <button class="btn" id="resetAllBtn">全てリセット</button>
</div>

</div>

<div id="consentModal" class="modal">
  <div class="modal-content">
    <h2>⚠ 注意 ⚠</h2>
    <p>
      配信媒体の規約や所属事務所等の規約を遵守し、
      国または自治体の法令・条例に則って活用してください。
    </p>
    <button id="consentBtn">確認</button>
  </div>
</div>

<script>
(function(){
const highArea=document.getElementById('highArea');
const lowArea=document.getElementById('lowArea');
const waitingArea=document.getElementById('waitingArea');
const toggleWinsBtn=document.getElementById('toggleWins');
const toggleStreakBtn=document.getElementById('toggleStreak');
const participantInput=document.getElementById('participantInput');
const addParticipantBtn=document.getElementById('addParticipantBtn');
const currentCardEl=document.getElementById('currentCard');
const curCenter=document.getElementById('curCenter');
const curTopLeft=document.getElementById('curTopLeft');
const curBottomRight=document.getElementById('curBottomRight');
const nextCardEl=document.getElementById('nextCard');
const nextGameBtn=document.getElementById('nextGameBtn');
const resultEl=document.getElementById('result');
const statsEl=document.getElementById('stats');
const resetBtn=document.getElementById('resetAllBtn');
const consentModal=document.getElementById('consentModal');
const consentBtn=document.getElementById('consentBtn');

let participants=[];
let showWins=false,showStreak=false;
let deck=[],current=null,nextCard=null;
const suits=[{sym:'♠'},{sym:'♥'},{sym:'♦'},{sym:'♣'}];
const ranks=[{r:'A',v:14},{r:'2',v:2},{r:'3',v:3},{r:'4',v:4},{r:'5',v:5},{r:'6',v:6},{r:'7',v:7},{r:'8',v:8},{r:'9',v:9},{r:'10',v:10},{r:'J',v:11},{r:'Q',v:12},{r:'K',v:13}];

function buildDeck(){const d=[];for(const s of suits) for(const r of ranks)d.push({rank:r.r,suit:s.sym,value:r.v}); return d;}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
function draw(){return deck.pop()||null;}
function effectiveValue(card){return card?card.value:0;}

// 参加者作成
function createParticipant(name){
  const p={name,bet:null,wins:0,currentStreak:0,dom:null,dragEnabled:false,x:0,y:0};
  const div=document.createElement('div');
  div.className='participant';
  div.textContent=name;
  div.style.left='0px';
  div.style.top='0px';
  p.dom=div;
  participants.push(p);
  enableDrag(p);
  waitingArea.appendChild(div);
  return p;
}

// ドラッグ
let dragged=null,offsetX=0,offsetY=0;
function enableDrag(p){
  if(p.dragEnabled) return;
  p.dom.addEventListener('mousedown', e=>{
    dragged=p;
    offsetX = e.clientX - p.dom.offsetLeft;
    offsetY = e.clientY - p.dom.offsetTop;
    p.dom.style.zIndex=1000;
  });
  p.dragEnabled=true;
}
document.addEventListener('mousemove', e=>{
  if(dragged){
    dragged.x = e.clientX - offsetX;
    dragged.y = e.clientY - offsetY;
    dragged.dom.style.left = dragged.x + 'px';
    dragged.dom.style.top = dragged.y + 'px';
  }
});
document.addEventListener('mouseup', e=>{
  if(dragged){
    // ドロップ判定
    let placed=false;
    [[highArea,'high'],[lowArea,'low'],[waitingArea,null]].forEach(([area,bet])=>{
      const rect=area.getBoundingClientRect();
      if(e.clientX>rect.left && e.clientX<rect.right && e.clientY>rect.top && e.clientY<rect.bottom){
        dragged.bet=bet;
        area.appendChild(dragged.dom);
        dragged.x=0; dragged.y=0; dragged.dom.style.left='0px'; dragged.dom.style.top='0px';
        placed=true;
      }
    });
    if(!placed){
      // 元に戻す
      dragged.x=0; dragged.y=0; dragged.dom.style.left='0px'; dragged.dom.style.top='0px';
      waitingArea.appendChild(dragged.dom);
      dragged.bet=null;
    }
    dragged.dom.style.zIndex='auto';
    dragged=null;
    renderParticipants();
  }
});

// オプション
toggleWinsBtn.onclick=()=>{showWins=!showWins; renderParticipants();}
toggleStreakBtn.onclick=()=>{showStreak=!showStreak; renderParticipants();}

// 参加者追加
addParticipantBtn.onclick=()=>{
  const name=participantInput.value.trim();
  if(!name) return;
  createParticipant(name);
  participantInput.value='';
  renderParticipants();
};
participantInput.addEventListener('keydown',e=>{if(e.key==='Enter') addParticipantBtn.click();});

// カード
function setCurrentCard(card){current=card;if(!card){curCenter.textContent='?'; curTopLeft.textContent='♦'; curBottomRight.textContent='♦'; return;}curCenter.textContent=card.rank;curTopLeft.textContent=card.suit;curBottomRight.textContent=card.suit;}
function setNextCard(card){nextCard=card;if(!card){nextCardEl.textContent='裏'; return;} nextCardEl.textContent='裏';}

// ラウンド開始
function newRound(){
  deck=buildDeck(); shuffle(deck);
  setCurrentCard(draw());
  setNextCard(draw());
  participants.forEach(p=>p.bet=null);
  renderParticipants();
  resultEl.textContent='カードをめくる前にベットを設定してください';
}

// 次カードめくり
nextCardEl.onclick=()=>{
  if(!nextCard) nextCard=draw();
  if(!current || !nextCard) return;
  nextCardEl.classList.add('animate-flip');
  setTimeout(()=>{
    nextCardEl.classList.remove('animate-flip');
    nextCardEl.innerHTML=`<div class="corner top-left">${nextCard.suit}</div><div class="center">${nextCard.rank}</div><div class="corner bottom-right">${nextCard.suit}</div>`;
    
    const curVal=effectiveValue(current), nextVal=effectiveValue(nextCard);
    highArea.classList.remove('highlight-high'); 
    lowArea.classList.remove('highlight-low');

    participants.forEach(p=>{
      if(!p.bet) return;
      const guess=p.bet;
      const win=(nextVal>curVal && guess==='high')||(nextVal<curVal && guess==='low');
      if(win){p.wins++; p.currentStreak++;}
      else p.currentStreak=0;
      if(win && guess==='high') highArea.classList.add('highlight-high');
      if(win && guess==='low') lowArea.classList.add('highlight-low');
    });

    renderParticipants();
    resultEl.textContent='結果表示中';
  }, 100);
};

// 次ゲーム
nextGameBtn.onclick=()=>{
  highArea.classList.remove('highlight-high');
  lowArea.classList.remove('highlight-low');
  nextCardEl.classList.add('animate-move');
  setTimeout(()=>{
    setCurrentCard(nextCard);
    nextCardEl.textContent='裏';
    nextCardEl.innerHTML='';
    nextCardEl.classList.remove('animate-move');
    nextCard=draw();
  },500);
  participants.forEach(p=>p.bet=null);
  renderParticipants();
  resultEl.textContent='次ゲーム開始';
};

// リセット
resetBtn.onclick=()=>{
  participants.forEach(p=>{
    p.bet=null;
    p.wins=0;
    p.currentStreak=0;
    p.x=0; p.y=0;
    p.dom.style.left='0px';
    p.dom.style.top='0px';
    waitingArea.appendChild(p.dom);
  });
  deck = buildDeck(); shuffle(deck);
  current = draw();
  nextCard = draw();
  setCurrentCard(current);
  setNextCard(nextCard);

  highArea.classList.remove('highlight-high');
  lowArea.classList.remove('highlight-low');

  renderParticipants();
  resultEl.textContent='リセットされました';
  statsEl.innerHTML='';
};

// 参加者描画
function renderParticipants(){
  participants.forEach(p=>{
    p.renderName = ()=>{
      let txt=p.name;
      if(showWins) txt+=' ('+p.wins+')';
      if(showStreak) txt+=' 連勝:'+p.currentStreak;
      p.dom.textContent=txt;
    };
    p.renderName();
  });
  // stats
  statsEl.innerHTML='';
  if(showWins){statsEl.innerHTML='勝利: '+participants.map(p=>`${p.name}:${p.wins}`).join(' | ')+'<br>';}
  if(showStreak){statsEl.innerHTML+='連勝: '+participants.map(p=>`${p.name}:${p.currentStreak}`).join(' | ');}
}

consentBtn.onclick=()=>{consentModal.style.display='none'; newRound();};
})();
</script>
</body>
</html>
